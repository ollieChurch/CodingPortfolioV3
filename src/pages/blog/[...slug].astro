---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getReadingTime } from '../../data/readingTime';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const readingTime = getReadingTime(post.body);

const formattedDate = new Date(post.data.date).toLocaleDateString('en-GB', {
  day: 'numeric',
  month: 'short',
  year: 'numeric',
});
---

<BaseLayout title={`${post.data.title} // Ollie`} description={post.data.description}>
  <article class="mx-auto max-w-4xl px-4 py-12">
    <header class="mb-8">
      <h1 class="text-2xl font-bold sm:text-3xl">{post.data.title}</h1>
      <time datetime={new Date(post.data.date).toISOString()} class="mt-2 block text-sm text-gray-400">
        {formattedDate} Â· {readingTime} min read
      </time>
      <p class="mt-3 text-gray-300">{post.data.description}</p>
      {post.data.tags.length > 0 && (
        <div class="mt-4 flex flex-wrap gap-2">
          {post.data.tags.map((tag) => (
            <span class="rounded-full bg-[var(--color-bg-dark-card)] px-2.5 py-0.5 text-xs text-[var(--color-cyan)]">
              {tag}
            </span>
          ))}
        </div>
      )}
    </header>

    <div class="prose prose-invert max-w-none">
      <Content />
    </div>

    <p class="mt-10 text-sm italic text-gray-400">
      Human written, AI assisted.
    </p>

    <div class="mt-6 flex items-center gap-3 border-t border-[var(--color-bg-dark-card)] pt-6">
      <button
        id="copy-link"
        class="cursor-pointer flex items-center gap-1.5 rounded-lg border border-[var(--color-bg-dark-card)] bg-[var(--color-bg-dark-surface)] px-3 py-2 text-sm text-gray-400 transition-colors hover:border-[var(--color-purple)] hover:text-gray-200"
      >
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
        </svg>
        <span id="copy-label">Copy link</span>
      </button>
    </div>

    <script is:inline>
      document.getElementById('copy-link').addEventListener('click', function() {
        var label = document.getElementById('copy-label');
        navigator.clipboard.writeText(window.location.href).then(function() {
          label.textContent = 'Copied!';
          setTimeout(function() { label.textContent = 'Copy link'; }, 2000);
        });
      });
    </script>
  </article>
</BaseLayout>
